# Tools Installation Instructions

This document describes how to install the EDA software tools that are needed to complete the projects described in this tutorial.

## Prerequisites

* A computer running x86 64-bit Ubuntu 18.04 LTS physically or in virtualization (via Qemu, UTM, Parallels, etc). Other versions of Ubuntu should also work, but procedures described were validated on 18.04 LTS.
* It should be possible to use a PC running Windows, but instructions for doing so are not provided here. Note that the last version of Windows supported by ISE Webpack is Windows 10. 
* macOS (including Apple Silicon-based Macs) may be used for simulating designs, but cannot natively run the Xilinx or Papilio software (tools used for synthesizing Xilinx `.bit` files and loading them onto the Papilio hardware). Mac users wanting to target designs for Papilio should use [UTM](https://mac.getutm.app) to emulate x64 Ubuntu. 

## What to Install?

If you do not have a Papilio board (or are interested only in simulating designs), then install:

* [Icarus Verilog](#icarus-verilog)
* [GTKWave](#gtkwave)
* [Yosys](#yosys-open-synthesis-suite)

If you have a Papilio development board, install everything described in this document:

* [Xilinx ISE WebPack](#xilinx-ise-webpack)
* [Papilio Loader](#papilio-loader)

## Icarus Verilog

> **_What's it do?_** Simulates hardware designs written in the Verilog language.
>
> **_Who needs it?_** Individuals interested in designing and simulating digital circuits in Verilog.

On Ubuntu:
```
$ sudo apt update             
$ sudo apt install verilog
```

On macOS:
```
$ brew install icarus-verilog
```

## GTKWave

> **_What's it do?_** Provides a GUI to view waveform output generated by Icarus Verilog and a variety of other industry standard circuit simulators.
>
> **_Who needs it?_** Individuals interested in designing and simulating digital circuits in Verilog.

On Ubuntu:
```
$ sudo apt install gtkwave
```

On macOS:
```
$ brew tap randomplum/homebrew-gtkwave
$ brew install --HEAD randomplum/gtkwave/gtkwave
```

## Yosys Open Synthesis Suite

> **_What's it do?_** Synthesizes Verilog hardware designs from _RTL_ into a gate-level netlist (for demonstration only; Xilinx EDA tools will be utilized to synthesize our design for the Papilio board.)
>
> **_Who needs it?_** Individuals interested in experimenting with the process of synthesizing Verilog into gate-level netlists.

On Ubuntu:
```
$ sudo apt install yosys
```

On macOS:
```
$ brew tap bsmt/homebrew-tap
$ brew install yosys
```

## Xilinx ISE WebPack

> **_What's it do?_** Synthesizes Verilog into a format that can be programmed into the Papilio's Spartan FPGA.
>
> **_Who needs it?_** If you intend to realize your Verilog code in hardware form, you need this software. There's no way around it. Skip this tool if you don't own a Papilio or other Spartan 6-based development board (it has no use if you're not targeting your design to these FGPAs).

Note that ISE was EOL'd in 2013 and is no longer actively maintained (although a new build was made available in February, 2018 to support Windows 10). Nevertheless, it's required for hardware designs targeting the older Spartan-family of FPGAs found on the Papilio hardware. Also note that Xilinx was acquired by AMD in 2022; while this project's documentation refers exlusively to "Xilinx" you will discover that websites and other marketing assets may refer to AMD. 

Xilinx makes ISE WebPack available at no cost, but the installation process is a hassle. Xilinx requires you to register on their website before downloading anything, the download size is _huge_ and then you have to generate and install a license file before using it.

_Xilinx does not offer a macOS version of the software._

#### 1. Download

Download the most recent version (14.7) of the ISE Design tools (full product installation, _all 6 GBs_ of it) from Xilinx's site, [here](https://www.xilinx.com/support/download/index.html/content/xilinx/en/downloadNav/vivado-design-tools/archive-ise.html). Find the "Full Installer for Linux" (or Windows) link and download it. If you have trouble downloading such a large file, you can download the installer broken into four segments (approximately 2GB each).

Note that you will have to create an Xilinx account and fill out a "US Government Export Approval" survey in order to download.

#### 2. Install

Windows users can execute the installer tool; Linux users should follow the instructions below:

  1. Un-tar the download (`tar -xvf <filename>`). If you've downloaded the segmented installer, be sure to have downloaded the other three segments but leave them intact (they should end in `.zip.xz`; don't try to untar or unzip these).
  2. Navigate into the un-tarred Xilinx directory, then run `xsetup` as superuser (`sudo ./xsetup`).
  2. When prompted for which suite of tools to install, choose **ISE WebPack** (note that this is not the default selection). Leave all other installation options as their default, and allow the tools to be installed into the (default) `/opt/Xilinx` directory.

#### 3. Fix the libraries (Linux)

ISE ships with an old version of the C Standard Library and installs it into your `LD_LOAD_LIBRARY` path. This will prevent most every other Linux tool from running in a shell that sources Xilinx's `settings.sh` scripts (as described below).

Disable obsolete versions of the C standard library to prevent issues with other tools:

```
sudo mv /opt/Xilinx/14.7/ISE_DS/common/lib/lin64/libstdc++.so /opt/Xilinx/14.7/ISE_DS/common/lib/lin64/libstdc++.so.disable
sudo mv /opt/Xilinx/14.7/ISE_DS/common/lib/lin64/libstdc++.so.6 /opt/Xilinx/14.7/ISE_DS/common/lib/lin64/libstdc++.so.6.disable
sudo mv /opt/Xilinx/14.7/ISE_DS/common/lib/lin64/libstdc++.so.6.0.8 /opt/Xilinx/14.7/ISE_DS/common/lib/lin64/libstdc++.so.6.0.8.disable
sudo mv /opt/Xilinx/14.7/ISE_DS/ISE/lib/lin64/libstdc++.so /opt/Xilinx/14.7/ISE_DS/ISE/lib/lin64/libstdc++.so.disable
sudo mv /opt/Xilinx/14.7/ISE_DS/ISE/lib/lin64/libstdc++.so.6 /opt/Xilinx/14.7/ISE_DS/ISE/lib/lin64/libstdc++.so.6.disable
sudo mv /opt/Xilinx/14.7/ISE_DS/ISE/lib/lin64/libstdc++.so.6.0.8 /opt/Xilinx/14.7/ISE_DS/ISE/lib/lin64/libstdc++.so.6.0.8.disable
```

#### 4. Fire it up

As noted in the installation wizard, you must source a shell script to configure your path, environmental variables and whatnot prior to running ISE WebPack.

For 64-bit Ubuntu users, this is as simple as:

```
$ source /opt/Xilinx/14.7/ISE_DS/settings64.sh
```

I find it convenient to source this settings file from my login script. Various Makefiles and instructions found in these tutorials assume that this script has been sourced prior to executing any Xilinx-related instructions. Add this your `.bashrc` file by executing this command:

```
echo 'source /opt/Xilinx/14.7/ISE_DS/settings64.sh > /dev/null' >> ~/.bashrc
```

Finally, you're ready to fire-up the ISE Design Suite software (but do not run as superuser):

```
$ ise
```

#### 5. Get a license

The first time you run ISE you'll be prompted to install a feature license. Follow the prompts to open the Xilinx License Configuration Manager (or choose "Manage License..." from the ISE "Help" menu) and follow these instructions:

1. Click the "Acquire a License" tab
2. Select the "Get free Vivado/ISE WebPack License" radio button
3. Click "Next"
4. A dialog will appear showing local system information; click "Save Information". Save the `Xilinx_Connect_Later.html` file to your filesystem.
5. Open the `Xilinx_Connect_Later.html` file with a web browser and complete the Xilinx registration and license request (there is no cost for this license but you do have to provide contact information and assure you're complying with applicable export laws).
7. The license file will be emailed to you. When you receive it, return to the Xilinx License Configuration Manager, click the "Manage Licenses" tab; click the "Load License..." button and navigate to the `.lic` file you received in email. Voila! You're ready to go!

## Papilio Loader

> **_What's it do?_** Loads the Xilinx-synthesized designs (created using ISE WebPack) onto the Papilio board.
>
> **_Who needs it?_** Individuals with a Papilio development board. Not useful to those without Papilio hardware.

The Papilio loader replaces standard JTAG device programming tools (providing a less expensive, more user-friendly approach to FPGA development). The most reliable way to install this software on Linux is to clone its Git repository and run the installer script.

The Papilio Loader requires Java and a USB device driver to operate, plus we'll be using Git to fetch it. Install these dependent packages first:

```
$ sudo apt update
$ sudo apt install default-jdk libftdi-dev git
```

Then, from within your home directory (or other convenient location), use Git to fetch the Papilio Loader source code:

```
$ cd ~
$ git clone https://github.com/GadgetFactory/Papilio-Loader.git
```

Run the Linux installer script (located in the source directory we just cloned):

```
$ cd Papilio-Loader/
$ ./linux-installer.sh
```

The installer script will load various application components in the `/opt/GadgetFactory/` directory and place links to the `papilio-loader-gui` and `papilio-prog` in `/usr/local/bin/`.
